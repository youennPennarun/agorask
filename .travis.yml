language: node_js
node_js:
- 6.2.0
services: mongodb
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/
env:
  matrix:
  - TRAVIS_NODE_VERSION: 6.1.0
  global:
  - MALLOC_ARENA_MAX=2
  - secure: V/xBg6e0GowlNXl5Y28/QRPJrhEcLIZDGtGV1xWb/Sdlh+6saPgr+cFxDPsNtujEzrylB9IL89AupDsDWWAI35zjTRKDxW464BsMiXFmuD5ccQQAhOOVIgIvb3nvmVngjqqInPPkNukYGrrqigv6SvZPwKkh31SbzNLrZJy6Cn/YfEl+EUMnXAKa84jU+rUTmGS22Szu7N6ZAzW2lHGL70r4sqUUfeHtHVx6qbmw03yGyrRJk2Js6e8GozFBp+uOt0JdoB5jMeacQVBsEO3mnkYr0HIv9+X/bgqr1CqFExsUcoHs/b4STDkUXkS3/rLZJIRu+/aemOSQ3mc5WsPt4nlzpz/tjl3+64aygWGPzmXODMFie77f4mc6l8K/rUBMaQKRqVDzC6qZkGvhJGMhFBX1grWoB6bY9l+/I1hJZDmI7xKXCjCRkkNyuVfT0XzUaa3GvqZQhd3CewVQbPtDV2CfjYNqxpfOMCgeVF0tLcGaSZ/3Rja+Wxfnoly/x+btfxugxfAixbpHkYIUI00fq8iPT1562FDt+yQkHsqZ4n+K3rh8STEaJHNTDMItv80I6AzJokUPCISJzKRs5wlAnsRysEBDjupu4xxo8TpoYTIiIL8DQsJrvJg/Sfkkwx/Fw0QodwHBzW9uLuHtIYoaqXTWxLNbXmzMCJtdjlmkLeI=
  - secure: e+deGm3iaYHxP4CpBV/Ro+/BUAZo4bC03mcKELltyn6XBtFO27Edwomg2+dxOOncMcJbC1tBg4qjhQ8SX5D0kyK0KNGJBmHqJTWQws0XKhtIbykuGfEotXH7eOl1XSvy9MUJCzcWCty618rtH1lavwSc/+xOM8vv4fkzEKGyNnKxo0beK8O7mkv3BI7OQsZJVVXSfEwrBzaPz05l3zF8ShCuYsY0EXmyr745IhQdAJpjjMR4+rfFGkpE7idM6JjFX1I+Ia+9UJrN8XV6F4DA8ywVdniP4hdmvLLH79wH38efe98Y+uzkM/07NQoHLT5YtEfXs6tBjgZpSDBhm3bDw9Zcjq87Xi+r5LlXrZWJqNFwgKYJyg+LcB+7zLgeosaBX0KNwHh+DjT/Jg3UX6KkYIqMdalVQVJ7J8VxE5hEDewGgTXzVfKy4UofzYOx6AsAV0AIK/mPYWKBc+7AMcU8sXw8AkkueK34dDFxLRad7+YizMhkyEYcUQTd4FX9nR9mK/xU2sAQ0CF1eldDYd3fYlYFjr268YSQti3gvbhG7WYHIeHtJ004zmi0IGwFrFDy16TVzWfhn3mgoy1jOwV0bxftxuN3CYUO3EWjWhJVVAhlUYDScXDCo4zns7b1Kk8V4N+p8KNRQhpyJM9Xt1ZGGDuprtad8VtjpVCahAF79y8=
  - secure: R0ylSkGmysmkbyzGPZnJ/3O0cJq1ipt4WvA2BbB6Ie35/LjM9dSy/UgBTsCS0zBB9JdkcXtyU8EcBQvnMS6Cck/reByqKVfyOgKyoGRW8ZAWOfoZUZ2oPv4j1e5NBf9t3wYZsr4sFOObPaHu+G/PS8CkbTOdL4JPfwHPDcASNojLpCDLXLOY1Sg3r9sNMQnNv/jykHG9qcxjb7z7lfi4CQTxf/nYfflzcoGejggrErDT2tGHqHK1x3pd9Nh+24K/1aAuLJkyYR1JjE+aGJy84rWHDFdxFbTbMsQSx1KZfhospa5ckHisoi3+twTy7EpqKOKE6IW48c3whf9Q/QYdmqsSw8htapH09xv1+EqGl50DAzura5nhhqesCFAV70yZf35llLiuH3Ioy6B4Omi++OHDb26uby1+d51L+F7bzxTlB7IPq+DaJlh0rosPUCo9gQisMr2ZYUfKdb3zZJZL1V5gAXk3R3/UtdolUL9GECE3JRCZparxy0nnLQRlt4ScrOvXApy8nmE8jc7m2eJzCifBVCM/fAXzqaeAHKAazG4nGiivU0EhT0ssrXNGu2+3W6ppE2ytGpJADt2dxvXxTF0brdeZBYlU0grlbsps91mbzo169UkM3GQgyQx6egwaeERMFyFOYMEoW7W7y0d2aRetrJMK92Bof0MCoJHejnU=
  - secure: C5WyB/iIDOhiGsx2x3q+Ty+tWxl+5PaZL4Pt8pl6NLxvhUBQrzfw3wYB+35IJaZnFVYJMVaRF5Uf9He50fB9Dg5JZZKRY9pEhj/u7gGiKKURHFYGEx4IbSghytZZ3lNIRH6KMY59WULfeG25QZ0hpn9shE0WDrYhUYUm5wNahRECFef3W7Ex4NoRrfMC3XNXet/GsqUMo0CiuPlB7eK2FJ5dGCyYVjlYvt/A1+79kAm+/wDTX+DXdGd96moAAkgrrGhAb0dtoB6dipqkLQ1f4M4jUFNr29uYjl3KANaaVOj2xtljqn5NWHZulApnxCwTU3vKt2JnAiBFsfjlAVM3nSPX+nLYPei8O2JmwwHcBULWJ5m7S952LIXsZMnZhhi0KAfgkeKRxqU05ggSX6Pb14c0n1I+SMerQ57h/DF1gPKB/ay7IGkA6CFgQeiG64rG8LD3+rJl822dER7SzMdGI+V2H7cH2awDnlZM3O2yxh0Sgn9Ds/BWaLz7DuDw1ShZLuQyzcW1/Nfl37CG2a71GyfJF7KKOa6dJ5PMRMLXAWrBOephkZTA+1igYyVYIfySd2Dno8XTQHVRco+xjhZMN4kvhxGuKnwP41cGbTuxGw6LmB4i4PSUfUmQ1FjOwaRPqI4eoImuKaACP+jGwGD4OM2YouuJLmPu1KpYUwHT6xg=
  - secure: MWBqIK+DPv+44JSlMeG/anjaqqN/gk0zerYvCEP79vm6hIR09M6svbVse+x3FztoYPnyLiZop9PO/uHNi6S3C0M4yu0K+Ff/rjhhyE0Y8pFjgdL3e5XT3B6luwmsUGXYRzOym+5fLiiKC4C1vQYvaF5doH9JkkiRHy49S3tl8gwtecHPJ5pomSMSlcQsZuYXOBqQjhAZH+Z8Jf3ocH8Q+wdrQuCDUkZqJXW4pdXxLssE3U+GLhPvp4MiGXuh3k2HjL3nQoeiiyeucaCulpi8hd+Q9rkJDlhc5TgBUBESWt325mvKz9iYY597CNbX9aBHJqJaEBvnCFb+FB2sXY2DtS430z22jxFWavUdKtNjWls8dZR42ho3MSqBXbs7hxCuwihAT/wsGMJP2IaKXNKFeRm63ZKjBnRSS42GOeY3YZqOW91anfYXD9ilP1dFe99kBwGQK5ml/ofKjicpkchR1cwH8HudCJfh5VEqTfCs+zpjj5MUkdPss2ibli1FlVp7XeYHq8Niq3BjOgU4n2A6XKRpKwUZnMVUChVGR3qQdS8PAn/CDpgMqm1EPm0tH5s9Lke/19QwSHw65X44jG7IY+4n+nmhN3mmXOxHLXByD3zVLQSitECqOVOWyl1dKcviMuHHbB5cIIW55QJ0BKO0adRH8Tuu0UfzbOpSbE/dBus=
  - secure: g20+MEFeV2mb98b8nKi3qvPWWBZPXAeXcVZ4sPMEEJR+9hqQbLD50fb2JU8PlwnC48MzYQ4kgdXvB+od4n3kJSl0uuJB1Cv2xGHjIYgj5a8eP2h8PxR44dxjOt/veQsQH/llraIplfZcFZul1yPgZSGw9XHS/YhCSz8tvcjX2ECRuRkM+RE9zfCsR+k7w+ki5PpnmGm3rSD8RhsRK13l53sa5DGGQICehFQ8dZTK3Q0Ss+J5qAnGV7T5csCEWCLBmAHbosHGwWV9LTPkfzq4Lr5Y4YmluW30PVJa+X2o/AZjge4TnNrYh+i6qD6E2608xwnwusiUW5AUyDMSfgr3gSfmzTqlz9wzljquzUgy/KcFYP+bBCzoTaHOAE+lLBF1UGyF3YaMf5N0/NxIE++WuFyGOHSFM7U7VekU5J1iwwMKOVei9MH1QmDkA9LosTNUmxpnsYEm/19+UprOzhrUhgh9MYASN5CLAeKmiCSB1/5dKTG+VtV74pKLzWWpBNO/7Lmk79CKWnC+DhHonRMl6kNaWKRCgK7maFuIz6yYJl9ChHa47UaBMtK17BUToUXq9/Lh1T3OFgz5r6ysbeu4UmSZXHWG3nMztYRzuGjQ/3wSCqJUpcuW94qGUeNN4bce253b+Gi8DcH4ANR1Hr3hq4yuhgbsRntja23InjMCQss=
  - secure: DpYg3hOqqvzqtQ2zaEY9S6waqZuSvy/jB3zizFgz1KY1x/+binLXPvkKbguTMehqFF8XQW9c3tSl53Er0cJgptkB33KxKNgUeQWykbKR50Fm+YMcu5yQEELPrCYydAdqCnKX/CsJRihiT019KWAaHpNgevX5KbvxtrlLz151M+kCCI+Jzt2RISrrV3YhRCXc5YcaILPb1DjS3SoZexHmDv+RNnMZp4l7umon64FbwxwwRnhx4J8JPJq7NLjF++DUY0RJGqN/LTwpeVuP3DmRZNe9gbCk2b3J69CSUBmaHDOP7L9o4B6RN/RyYMDwpv293M8ASAA+wj9SESzPQ1EBC+5ZplsPzCTGYw0n5enntEr/8ZGCJu8dn1tRdst+R/kgAv5VhKb/noYvBsLBhOKv1lqrgh8vxUXtj2rdtBZ8wPuNlRdEKTVbJANL3wWrkEnVerk6en1zGCWvyunJ0leuEBE+qA3ZPIHHFIHnDljGxqTIwdCVoV9K+z6aGexx84e9cLStSaZ3YcBEXaf/x1HzZQu71JbiNJ25B3HGM84aIlK0/pICLxfLwfQla+LR0JhPRgJMcH/Wvr9zEn2OjL/j+I8nd54mOLoDVq6MYcBrGAAqCs8UP3bf9Pyv9YT9873w/Os1pDNjwhW5Sf0G3l9ADd+V61+pbB+okzzfDGBoorA=
  - secure: t1zKH6ObjAtcON92oQBqCkK7EZcOHBQIrwepWBglwH4GWjjwynd5RyDgvxqulGlwJtVUwSik7tCiVWefanBEcVHKlwxMHtNFY9nxxrKVrL19l5bUOTmuB0g5F9EF3d71+p6/FMUUOmrtB8mFXaXUO3xykLoKAQvwu0/E47xTIIrLl8uwaEKNhRvcvQeDQMFglR/0kVV80IV6A5b63P/y0E/UAbJuxScMFQePJ/cnXY5V+g0wXFPSBK324ZJebkOjS7Enz2lm5hS3zyK2FaqDARLybjGyj06OqZIBT6bqsUPjspzmUJjhruFEB3CiHlhRrxIJium7cYRrbKyvo6XsysjImbMCozobjfObxOKXbF6VM1WItIPqGkbWY9NmrnRFmlBwmmUifcIEiDaz0UT3009uqySGfhFj5wPxpByA1QpD2VctjlZnI4wBOr+/3Bx/8eJ4M7jVyZKGaDEPnnZJr5c8WIYAPNwnh7gCb2R3WHQWXn8bkDUxXhIax4unb402b3aEjvDmmaDVtO1lWmec9Dk1+zQwxCDg97xXvASk9zhQqPYp91SPai7TNpWamSRYrHTGBZg1g5NhmxpYV/5cnp3fWGRV/1VJwWy2nxmV/oogqtzFZ91klznxT21xLclKBOr5LMj9q2zZkAKH8IJlC0tm6tWb0qmVNnNwL9Xao4s=
  - secure: lODuhqiMvYArUolq7PT0J48L/qMyZwJfFlVUVaF8c3hoXYbrv8r15HdyS1rB2/R9MuiL26vcSomvPew6HD73R1Zkvi5zfRFHm10cERNlOGWYbSqgkHrbRUJt2IhIeBGeww2DnWYLWUoN/QdsnGAkbysf+B1vsiybw8gOz02YrYshUEWok6rVU2CNjCoY41/bYayNZ1ZMfPyQgaMXuYgTId8o7X24VK9wP4EM+YfirqKtBidjMWloDedHOsXQ8F6iMT+uM2aYVngQ4A5rE2DsdNMcIqgdS0n4G8e4D9TuwRE7Vlo7nkca1RxMqnnTZQWHPRUq2KcAJ786qZ8qOW+nLL00GGXWviIZjvUwjM0wr2kES086xJbgXRMjY1PKkIV+K32exVqBcWE+NA2uKCAn4PBq8MX7sxKKDgkHHpZng6zPrzdM48iJZaM2yYZqI3hlVecBkmwCjTEunVNOMYs+hSRnnD6/ZrAYY6cViCpLnt65KLI9dVjiMo/PG9em/VQLNOsPOd3wU5FaOuyggEQb7XpfoZ8/DLIsR9+O18Uu4AqqxFISvGRIxqPhh4CJbg/MmtwXWTeEeXuyWSlkBSamtWJ4Uy1/Qmg95b4Bc3DshQMzvIYDkN/i1yvP9hjWqtd8xfKB3UtXTiYzWmDjcmvnA3SBr4fOmfXwJiStu34kkE4=
  - secure: oz5qV4wykMO14a1DydEIf5hnCzvs7YbW1FoPM9Zy4AZ/IPO89c4mv/i9PnsAky4pGmaGAA4ebQE1aPxI+cGv4HBPWofelhZJroufhWMcFn50CxtzMzWRJzA5TT16fvosqjxN0ld/2+3e88lfttqdzU1NxBSPtcq5crshHdjpfv8mY8qbtYgzD2gqseHmDeTm3TboV7J5PQFjFKYcNcDZv+5ZhsPhBJO+PFdhfoZyDQu1ZyDfvK61dtHPwYZVkZYTvTfiI4yXma5JIdXW6jy6Jah0JpfljwgrWfvtGtMRuBVUKXWIgJHpsdpybSiDtO+OUjdyTVHYDmurGJwFNWxl1voEW30iR0wwwSZs4LL0CcrCy4s3m5kWq1qAFEkrl3uTCjzr/3nmKuzGv1bFS+jcFP9fkLXNf5haK7pYqtNJqRv/z+fPGYhKOmOMmhB9Qc4dogHewW8pAjKv3osumVKEfDf1XKwCqLM2uuKoMS6P8Oo5MwfabB2T8LtQwMBhG56Kp6WUXIRZBi8u311LmvoLGdNq2BosvSv7gjpBfTOn3wbOZ3RamXn44h7XLjMdO3v9+tyHtXLIAixgRAlKSNhmPfyC8jMKfMTAnZCJbTK5yPm6+we9ovKQirLHfhALJcRenEBbGzFonANLwNgYM7IXfnrCuqjnH8UxLqoNyiL7ktw=
  - secure: T2FVhbjP2VIPybYnvfDFZ8MDeg1AI/uBi3rGHjjaeNzNDr1ER5TtLi9Amp8q+uvhTBbE56RvzQo7awyV6c/oUKJl6nFZfgJKOo3TktW7GaHdLb6dZ8nV43oFaIb9dCX31jrtVymr5XjGAHjUMxzy6JjtxuZxjyrHgQNKekMr/rrSUWNuVr0Oq2Nlc/F11bcxdtxURVqZcf2nZjwncyaBqd2y6+UCYw4NPJ6LXB0bbSQ/5RvXijIsJ5DIqb9TzhT8+Wyce9DRYnkVoVnP7IPYxJq4oFgiPfnoNSzmklROMfDyBWV6ijoKn/jS0fldm3xGPIRqOWy0Wh7WrewRW9scstfe09kpF1KyI6K/mSSP1Fu8RET7jlmYMM8xuksMducMYn2eHWbM9hAgNXLhmGr9pleOUEUgpIeXNcwRf2o7uzUcajWaXY+ltkodlYgSjRQg+mRyFVCchxMNvrain5whKy/533NPMSz+/uB8cxKoMCZ8zKLJygEdi8uivXw87HL19cWztcqtr2mEqEbZf5BNnZUpQypcDdBEqNySvJdEo7/7eZwYCYWuZzWS4npavmwSeLkkRCU/aXFT0vbdPhujPAQJR47GjLdKT0Grn0BuEwODkzv5eMlWHxiG+Y2ubB+m0TPwHEvgEfQKMB+djn6NS7Z1YOGqLTRdus7V7c4c9eU=
before_install:
- openssl aes-256-cbc -K $encrypted_95f6ce8b3da2_key -iv $encrypted_95f6ce8b3da2_iv
  -in release.keystore.enc -out mobile_app/android/release.keystore -d
- mkdir $TRAVIS_BUILD_DIR/tmp  && cd $TRAVIS_BUILD_DIR/tools/travis/ && npm install
matrix:
  include:
  - env: TEST_DIR=server MONGO_URL=mongodb://localhost/agorask SHOULD_BUILD_IF_EXISTS=TRAVIS_BUILD_SERVER
    script: cd $TRAVIS_BUILD_DIR/server && npm install && ENV=test npm run codecov
    before_deploy: cd $TRAVIS_BUILD_DIR/server
    deploy:
    - provider: heroku
      api_key:
        secure: Ur+KY9x/T++N60xOqyza9CqnGTTCD4Wv2gC+WzpCUP6VF+YV8FOWidyK2cHvaTO8kvW1SGY4OR0tx7uEALkAgcwrUoNlcPmbibFEGBbbq8jAp2Ba2GUlmFJDj5xQngzgcNReC5Mso8CNQ19IfbMfabq455i/Q6Fc9w2yOwiO401fz2Mgnnpz2p2kYrtBPOkOn7S5Wj96/vcIrbrG4wCsjuPPJScoCYQJZAYOt/CUMLKY+iCiYN/61fSkezd/CaYgyrVvlFJeh90R49mSDB3G80RfVBijiiTDHe5mG2XAXUt51WzbQMVAHuQ8yWjU0VXjeh1ZZoToMcPJU2wBpXSLzw3bZSBsBR/jzs8mcQW+fXEB0wQCYgzvTheJcTeURHyX/J/QS8RE9/JA4yxbRTcTYNhxqsArXzGnrfLWaxnCdZuOt2rEn4FXkuL5vtK2Ms8Zzs8Pz8GyOF9ORb5DlfPPzFgjNCkB5WmgO+PWCJV/8Y/rHv1iB8aFrrUl//5E+2UGZ3q2WGmqVZ8HMHm/NWAaTQwXER+rSNnQJUpuIpoHmBSC95/N8pM/PW5nH0a/euxwAvZUmoGieZ3aBkPkCHkdPQiPyxVc60LvjdVgiWMK0rx6szwGnlKFLZqNFGc924IkKeZGdOw9AcJSoZoUO0qpoZ74TjOJYlHqsDE/6cVfuCs=
      app: agorask
      on:
        branch: master
        condition: $TEST_DIR = server
    - provider: heroku
      api_key:
        secure: Ur+KY9x/T++N60xOqyza9CqnGTTCD4Wv2gC+WzpCUP6VF+YV8FOWidyK2cHvaTO8kvW1SGY4OR0tx7uEALkAgcwrUoNlcPmbibFEGBbbq8jAp2Ba2GUlmFJDj5xQngzgcNReC5Mso8CNQ19IfbMfabq455i/Q6Fc9w2yOwiO401fz2Mgnnpz2p2kYrtBPOkOn7S5Wj96/vcIrbrG4wCsjuPPJScoCYQJZAYOt/CUMLKY+iCiYN/61fSkezd/CaYgyrVvlFJeh90R49mSDB3G80RfVBijiiTDHe5mG2XAXUt51WzbQMVAHuQ8yWjU0VXjeh1ZZoToMcPJU2wBpXSLzw3bZSBsBR/jzs8mcQW+fXEB0wQCYgzvTheJcTeURHyX/J/QS8RE9/JA4yxbRTcTYNhxqsArXzGnrfLWaxnCdZuOt2rEn4FXkuL5vtK2Ms8Zzs8Pz8GyOF9ORb5DlfPPzFgjNCkB5WmgO+PWCJV/8Y/rHv1iB8aFrrUl//5E+2UGZ3q2WGmqVZ8HMHm/NWAaTQwXER+rSNnQJUpuIpoHmBSC95/N8pM/PW5nH0a/euxwAvZUmoGieZ3aBkPkCHkdPQiPyxVc60LvjdVgiWMK0rx6szwGnlKFLZqNFGc924IkKeZGdOw9AcJSoZoUO0qpoZ74TjOJYlHqsDE/6cVfuCs=
      app: agorask-dev
      on:
        branch: development
        condition: $TEST_DIR = server
    after_build: touch $TRAVIS_BUILD_DIR/SERVER_DEPLOYED
  - env: TEST_DIR=mobile_app SHOULD_BUILD_IF_EXISTS=TRAVIS_BUILD_APP
    language: android
    jdk: oraclejdk8
    node_js:
    - 6.1.0
    android:
      components:
      - tools
      - tools
      - build-tools-23.0.1
      - build-tools-23.0.3
      - android-23
      - android-24
      - extra-google-google_play_services
      - extra-google-m2repository
      - extra-android-m2repository
      - extra-android-support
    before_install: nvm install 6.1.0 && nvm use 6.1.0
    before_script: cd $TRAVIS_BUILD_DIR/mobile_app && npm install
    sudo: required
    before_deploy: cd $TRAVIS_BUILD_DIR/tools/travis/buildApplication && npm install
    deploy:
    - provider: script
      skip_cleanup: true
      script: cd $TRAVIS_BUILD_DIR/tools/travis/buildApplication/ && node deployApplication.js
      on:
        branch: master
    - provider: script
      skip_cleanup: true
      sudo: required
      script: cd $TRAVIS_BUILD_DIR/mobile_app/android && ./gradlew assembleRelease
        --stacktrace --info
      on:
        branch: development
script: echo "Need to make integration tests (with the app connected to the server...)"
after_script: echo "after script"
notifications:
  email:
  - youenn.pennarun@gmail.com
